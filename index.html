<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <!-- <script src="src/app.js"></script> -->
  <script src="node_modules/rangy/lib/rangy-core.js"></script>
  <script src="node_modules/rangy/lib/rangy-classapplier.js"></script>
  <script src="node_modules/undo.js/undo.js"></script>
  <script src="node_modules/medium.js/medium.js"></script>
  <script src="src/bundle.js"></script>
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="node_modules/medium.js/medium.css">

  <!--[if lt IE 9]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
</head>

<body>

  <div contenteditable="true" id="editable">
    Here is some text. Please put the caret somewhere in here.
  </div>
  <div id="precedingChar" style="font-weight: bold"></div>

  <script>
    function getCharacterPrecedingCaret(containerEl) {
        var precedingChar = "";
        var sel;
        var range;
        var precedingRange;

        if (window.getSelection) {
            sel = window.getSelection();
            if (sel.rangeCount > 0) {
                range = sel.getRangeAt(0).cloneRange();
                range.collapse(true);
                range.setStart(containerEl, 0);
                precedingChar = range.toString().split(" ").pop().replace(/[.,!?:;'"-%]+/g,''); //gets word before caret and removes punctuation
                // precedingChar = range.toString().slice(-1);
            }
        } else if ( (sel = document.selection) && sel.type != "Control") {
            range = sel.createRange();
            precedingRange = range.duplicate();
            precedingRange.moveToElementText(containerEl);
            precedingRange.setEndPoint("EndToStart", range);
            precedingChar = precedingRange.text.slice(-1);
        }
        console.log(precedingChar)
        return precedingChar;
    }

    var editableEl = document.getElementById("editable");
    getCharacterPrecedingCaret(editableEl);

    editableEl.onkeyup = function(e) {
      if(e.keyCode == 32) {
        spacePressed();
      }
    }

    function spacePressed() {
      console.log('space pressed')
      getCharacterPrecedingCaret(editableEl);
    }
  </script>


  <br><br>



  <div class="toolbar-top">
    <span class="toolbar">
     <span class="li">LI</span>
    </span>
  </div>
  <div id="rich_with_insert_html_object" class="article demo">
  ...object
  </div>

  <div id='editor' contenteditable='true'>...hello</div>

  <script>
    (function() {

      var article = document.getElementById('rich_with_insert_html_object')
      var medium = new Medium({
        element: article,
        mode: Medium.richMode,
        placeholder: 'Your Article',
        tags: null,
        attributes: null
      })

      //example of how to insert into contenteditible
      var container = article.parentNode

    	container.querySelector('.li').onmousedown = function() {
    		var ul = document.createElement('ul')
    		var li = document.createElement('li')

    		ul.style.border = 'dashed 5px #F92672';
    		ul.className = 'ul-special';
    		ul.appendChild(li);

    		li.innerHTML = 'I came from an Object!';
    		li.style.color = '#57ad68';
    		li.className = 'li-special';

  	    medium.focus();
  	    medium.insertHtml(ul);

  	    return false;
    	};
    })();
  </script>
</body>
</html>